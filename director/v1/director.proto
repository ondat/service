syntax = "proto3";
package director.v1;

import "common.proto";

/**
 * Director configuration and status service.
 */
service Director {
    /**
     * Add configuration for the given DirectorVolume message.
     *
     * @return  RpcResult
     */
    rpc VolumeCreate(DirectorVolume) returns (RpcResult) {}

    /**
     * Update configuration for the given DirectorVolume message.
     *
     * @return  RpcResult
     */
    rpc VolumeUpdate(DirectorVolume) returns (RpcResult) {}

    /**
     * Remove configuration for the given DirectorVolume message.
     *
     * returns RpcResult
     */
    rpc VolumeDelete(DirectorVolume) returns (RpcResult) {}

    /**
     * List configured volumes, optionally filtered using a DirectorVolumeListQuery
     * message.
     *
     * returns  A DirectorVolumeList message containing DirectorVolume objects,
     *          if any are found matching the filter
     */
    rpc VolumeList(DirectorVolumeListQuery) returns (DirectorVolumeList) {}

    /**
     * Add configuration for a Presentation volume specified in the DirectorPresentation message.
     *
     * returns RpcResult
     */
    rpc PresentationCreate(DirectorPresentation) returns (RpcResult) {}

    /**
     * Update configuration for a Presentation volume specified in the DirectorPresentation message.
     *
     * returns RpcResult
     */
    rpc PresentationUpdate(DirectorPresentation) returns (RpcResult) {}

    /**
     * Remove configuration for the Presentation volume specified in the DirectorPresentation message.
     *
     * returns RpcResult
     */
    rpc PresentationDelete(DirectorPresentation) returns (RpcResult) {}

    /**
     * List configured Presentation volumes, optionally filtered using a DirectorPresentationListQuery
     * message.
     *
     * returns A DirectorPresentationList message containing DirectorPresentation mesages,
     *         if any are found matching the filter.
     */
    rpc PresentationList(DirectorPresentationListQuery) returns (DirectorPresentationList) {}
}

message DirectorVolumeListQuery {
    // A possibly-empty list of volume IDs to query.
    repeated uint32 volume_ids = 1;
}

message DirectorVolumeStatistics {
    // Empty for now.
}

message DirectorVolumeStatus {
    // Empty for now.
}

/**
 * Volume message for Director RPCs.
 *
 * Note this does should not be used to configure Presentation inodes, volumes that point
 * at other volumes. Use DirectorPresentation for that.
 */
message DirectorVolume {
    DataplaneCommon cc = 1;

    // The volume ID.
    uint32 volume_id = 2;

    // The write_pipe (identifies the plugin).
    uint32 write_pipe = 3;
    // The read pipe (should be write_pipe + 1 in all current plugins).
    uint32 read_pipe = 4;

    // Quality of service indicator.
    uint64 qos = 5;

    // List of replica inodes.
    repeated uint32 replica_ids = 6;

    // Volume statistics.
    DirectorVolumeStatistics stats = 7;

    // Volume status, e.g. retry condition.
    DirectorVolumeStatus status = 8;
}

message DirectorVolumeList {
    repeated DirectorVolume volumes = 1;
}


message DirectorPresentationListQuery {
    // A possibly-empty list of volume IDs to query.
    repeated uint32 presentation_id = 1;
}

/**
 * Presentation volume message for Director RPCs.
 *
 * The minimum amount of information required to specify the 'presentation' or source volume,
 * the volume that is presented to the user and (usually) mounted. All actual work
 * is done on the target volume, which has actual storage associated with it.
 */
message DirectorPresentation {
    DataplaneCommon cc = 1;

    // The inode the user mounts or opens.
    uint32 source_id = 2;

    // The underlying inode of the StorageOS volume.
    uint32 target_id = 3;
}

message DirectorPresentationList {
    repeated DirectorPresentation presentations = 1;
}
